[![Coverage Status](https://coveralls.io/repos/github/xC-ell/xCell/badge.svg?branch=master)](https://coveralls.io/github/xC-ell/xCell?branch=master)
![](https://raw.githubusercontent.com/JaimeRZP/Cosmoteka_tutorials/master/docs/src/assets/cosmoteka_logo.png)

Welcome to the Cosmoteka, the largest repository of consistently combined angular power spectra in Cosmology! 

# Mappers
| | | 
|:-------------------------:|:-------------------------:|
|![](https://raw.githubusercontent.com/JaimeRZP/Cosmoteka_tutorials/master/docs/src/assets/masks_3.png)| ![](https://raw.githubusercontent.com/JaimeRZP/Cosmoteka_tutorials/master/docs/src/assets/masks_2.png)|
|![](https://raw.githubusercontent.com/JaimeRZP/Cosmoteka_tutorials/master/docs/src/assets/masks_1.png) |![](https://raw.githubusercontent.com/JaimeRZP/Cosmoteka_tutorials/master/docs/src/assets/masks_4.png)|


| Mapper            | Description                       | Science                                                               |  Cataloge                                                                                         |  Contributor           |
| -----------       | -----------                       | --------                                                              |  --------                                                                                         |  --------              |
| ```2MPZ```        |  Galaxy clustering                | [Bilicki et al, 2013](https://arxiv.org/pdf/1311.5246.pdf)            | [catalogue](http://ssa.roe.ac.uk/TWOMPZ.html)                                                     | D. Alonso              |
| ```ACTtSZ```      | CMB anisotropies                  | [Madhavacheril et al, 2019](https://arxiv.org/abs/1911.05717)         | [catalogue](https://lambda.gsfc.nasa.gov/product/act/act_dr4_derived_maps_get.html)               | J. Ruiz-Zapatero       | 
| ```ACTCMB```      | CMB anisotropies                  | [Madhavacheril et al, 2019](https://arxiv.org/abs/1911.05717)         | [catalogue](https://lambda.gsfc.nasa.gov/product/act/act_dr4_derived_maps_get.html)               | J. Ruiz-Zapatero       |
| ```ACTk```        | CMB convergence                   | [Darwish et al, 2020](https://arxiv.org/abs/2004.01139)               | [catalogue](https://lambda.gsfc.nasa.gov/product/act/act_dr4_derived_maps_get.html)               | J. Ruiz-Zapatero       |
| ```BOSS```        | Galaxy clustering                 | [Alam et al, 2016](https://arxiv.org/abs/1607.03155)                  | [catalogue](https://data.sdss.org/sas/dr12/boss/)                                                 | J. Ruiz-Zapatero       |
| ```CIBLenz```     | CIB ansitropies                   | [Lenz et al, 2019](https://arxiv.org/abs/1905.00426)                  | [catalogue](https://dataverse.harvard.edu/dataset.xhtml?persistentId=doi:10.7910/DVN/8A1SR3)      | J. Ruiz-Zapatero       |
| ```CatWISE```     | Galaxy clustering                 | [Marocco et al, 2020](https://arxiv.org/abs/2012.13084)               | [catalogue](https://irsa.ipac.caltech.edu/data/WISE/CatWISE/gator_docs/catwise_colDescriptions.html) | F. Oliveira-Franco  |
| ```DELS```        | Galaxy clustering                 | [Dey et al, 2019](https://arxiv.org/abs/1804.08657)                   | [catalogue](https://www.legacysurvey.org/dr8/catalogs/)                                           | D. Alonso              |
| ```DESY1gc```     | Galaxy clustering                 | [Abbot et al, 2017](https://arxiv.org/abs/1708.01530)                 | [catalogue](https://desdr-server.ncsa.illinois.edu/despublic/y1a1_files/redmagic/)                | C. Garcia-Garcia       |
| ```DESY1wl```     | Weak lensing                      | [Abbot et al, 2017](https://arxiv.org/abs/1708.01530)                 | [catalogue](https://desdr-server.ncsa.illinois.edu/despublic/y1a1_files/shear_catalogs/)          | C. Garcia-Garcia       |
| ```DESY3wl```     | Weak lensing                      | [Abbot et al, 2021](https://arxiv.org/abs/2105.13549)                 | [catalogue](https://desdr-server.ncsa.illinois.edu/despublic/y3a2_files/)                         | C. Garcia-Garcia       |
| ```eBOSS```       | Quasar clustering                 | [Gil-Marin et al, 2018](https://arxiv.org/abs/1801.02689)             | [cataloge](https://data.sdss.org/sas/dr14/eboss/)                                                 | J. Ruiz-Zapatero       |
| ```HSC_DR1wl```   | Weak lensing                      | [Aihara et al, 2017](https://arxiv.org/abs/1702.08449)                | [catalogue](https://hsc-release.mtk.nao.ac.jp/doc/index.php/tools/)                               | D. Alonso              |
| ```KiDS1000```    | Weak lensing                      | [Heymans et al, 2020](https://arxiv.org/abs/2007.15632)               | [catalogue](https://kids.strw.leidenuniv.nl/DR4/data_files/)                                      | D. Alonso              |
| ```NVSS```        | Galaxy clustering                 | [Condon et al, 1998](https://iopscience.iop.org/article/10.1086/300337/pdf) | [catalogue](https://www.cv.nrao.edu/nvss/)                                                  | F. Oliveira-Franco     |
| ```P15tSZ```      | Compton-y map                     | [Planck Collaboration, 2015](https://arxiv.org/abs/1502.05956)        | [catalogue](https://irsa.ipac.caltech.edu/data/Planck/release_2/all-sky-maps/ysz_index.html)      | J. Ruiz-Zapatero       |
| ```P18CMBk```     | CMB convergence                   | [Planck collaboration, 2018](https://arxiv.org/abs/1807.06210)        | [catalogue]( http://pla.esac.esa.int/pla/aio/product-action?COSMOLOGY.FILE_ID=COM_Lensing_4096_R3.00.tgz)                                                                                                  | J. Ruiz-Zapatero       |
| ```P18CMB```      | CMB anisotropies                  | [Planck Collaboration, 2018](https://arxiv.org/abs/1807.06208)        | [catalogue](https://irsa.ipac.caltech.edu/data/Planck/release_2/all-sky-maps/foregrounds.html)    | J. Ruiz-Zapatero       |
| ```ROSAT```       | X-ray count rate                  | [Vogue et al, 1999](https://arxiv.org/abs/astro-ph/9909315)           | [catalogue](https://heasarc.gsfc.nasa.gov/FTP/rosat/data/)                                        | D. Alonso              |
| ```SPT```         | Compton-y map                     | [Bleem et al, 2021](https://arxiv.org/abs/2102.05033)                 | [catalogue](https://lambda.gsfc.nasa.gov/product/spt/spt_prod_table.html)                         | J. Ruiz-Zapatero       |
| ```WIxSC```       | Galaxy clustering                 | [Bilicki et al, 2016](https://arxiv.org/abs/1607.01182)               | [catalogue](http://ssa.roe.ac.uk/WISExSCOS.html)                                                  | D. Alonso              |

# Design Philosophy
![](https://raw.githubusercontent.com/JaimeRZP/Cosmoteka_tutorials/master/docs/src/assets/Cosmoteka_schematic_v2.png)

Cosmoteka is a single pipeline that processes catalog level data from a wide variety of surveys and measures their angular power spectra and covariances in a consistent manner. Cosmoteka heavily relies on `NaMaster`.

Cosmoteka is designed to allow for the largest amount of modularity possible to encourage open-source community development. Inside of each module, Cosmoteka follows an object-oriented approach. Thus, given some configureation file, each module defines a series of objects which host the methods used to process the data at each step of the pipeline. 

Cosmoteka is fundamentally divided in two modules, `cls` and `mappers`, which can be thought as the brain and muscles respecively of the same organism. `cls` processes the demands the user can make through a configuration file and returns an instance of the relevant `mappers` to compute the  corresponding `NaMaster` fields. In order to understand, how the `mapper` modules compute the `NaMaster` fields we can look the `mapper_base.py`, the mapper module which defines the parent class for all other mappers inside Cosmoteka. As the parent class, `mapper_base` defines a series of default methods which are then overwritten by the child mappers to perform the data processing specific to each data set. Moreover, it also defines common methods to each mapper. The most important of these methods is `get_nmt_field` which returns the `NaMaster` field from each mapper. Inside `get_nmt_field`, the signal map and mask of each mapper are computed according to the specifc methods of the children mappers. Then, the signal map and mask as well as other mapper specific quantities (data beam, contaminants,... etc) are passed on to `NaMaster` to compute the final field. Once the `NaMaster` fields are computed, `cls` orchestrates the computation of the angular power spectra and their covariance requested by the user. A brief description of the role of each module inside `cls` can be found in the table below. For a more detailed description of the role of the  `cls` modules as well as the individual mappers please visit the documentation of Cosmoteka.

| Module            | function                                                                                                                             |
| -----------       | :-----------                                                                                                                         |
| ```cls/cl.py```       | Computes the Cl's requested by the user in the configuration file from the `NaMaster` fields provided by the mappers.                |
| ```cls/cov.py```      | Computes the covariance matrix of the Cl's either from the maps themselves or using the theoretical predictions of ```theory.py```.  |
| ```cls/data.py```     | Reads the user configuration file and reaches out to the relevant mappers.                                                           |
| ```cls/theory.py```   | Computes the a theory prediction for the Cl's computed in  `cl.py` using  `pyccl` (only available for certain observables).          |
| ```cls/to_sacc.py```  | Saves all the angular power spectra as well as their covariance matrix to a `SACC` file.                                             |
| ```Mappers```  | Saves all the angular power spectra as well as their covariance matrix to a `SACC` file.                                             |

# Usage
In order to run the code use `python3 run_cls.py input/kv450_1024.yml cls`.
You can see the different options with `python3 run_cls.py -h`.

You can run directly `xcell/cls/cl.py`, `cov.py`, `to_sacc.py` with `python3 -m` as `python3 -m xcell.cls.cl input/kv450_1024.yml KV450__0 KV450__0`.

More info about the sacc files in https://github.com/LSSTDESC/sacc

# Tutorials
Tutorials on how to configure and use all the different mappers  to compute angular power spectra and their covariance matrix can be found [here](https://github.com/xC-ell/Cosmoteka_tutorials).

# Publications
- J. Ruiz-Zapatero et al, "LimberJack.jl: auto-differentiable methods for angular power spectra analyses", Arxiv:2310.08306, 2023.
-  David Alonso et al, "Constraining cosmology with the Gaia-unWISE Quasar Catalog and CMB lensing: structure growth", Arxiv:2306.17748, 2023.
- T. Ferreira et al, "X-ray - cosmic shear cross-correlations: first detection and constraints on baryonic effects", Arxiv:2309.11129, 2023.
- B. Hadzhiyska et al, "Cosmology with 6 parameters in the Stage-IV era: efficient marginalisation over nuisance parameters", Arxiv:2301.11895, 2023.
- J. Ruiz-Zapatero et al, "Analytical marginalisation over photometric redshift uncertainties in cosmic shear analyses", Arxiv:2301.11978, 2023.
- B. Jego et al, "Constraining the physics of star formation from CIB-cosmic shear cross-correlations", Arxiv:2209.05472, 2022.
- B. Jego et al, "The star formation history in the last 10 billion years from CIB cross-correlations", Arxiv:2206.15394, 2022.
- C. Garcia-Garcia et al, "Combining cosmic shear data with correlated photo-z uncertainties: constraints from DESY1 and HSC-DR1", Arxiv:2210.13434, 2022.
- B. Hadzhiyska et al, "Hefty enhancement of cosmological constraints from the DES Y1 data using a Hybrid Effective Field Theory approach to galaxy bias", Arxiv:2103.09820, 2021.
- C. Garcia-Garcia et al, "The growth of density perturbations in the last ∼10 billion years from tomographic large-scale structure data", Arxiv:2105.12108, 2021.
- A. Nicola et al, "Cosmic shear power spectra in practice", Arxiv:2010.09717, 2020.

# Contributors

Looking forward to seeing your name below!

| | | | |
|:-------------------------:|:-------------------------:|:-------------------------:|:-------------------------:|
|<img src=https://github.com/carlosggarcia.png  width="200" height="200" /> |<img src=https://github.com/jaimerzp.png  width="200" height="200" /> |<img src=https://github.com/damonge.png  width="200" height="200" />|<img src=https://github.com/oliveirafrancofelipe.png  width="200" height="200" /> |
| Carlos Garcia-Garcia | Jaime Ruiz-Zapatero | David Alonso| Felipe Oliveira-Franco |
| Lead angular power spectra <br /> and covariance code designer. <br /> Mappers| Mapper Design & Mappers | Mapper Design & Mappers | Mappers |

# Citing Cosmoteka

We are currently working on a Cosmoteka paper presenting the library in detail to the astronomy comunity. 
In the mean time please cite:
```
@ARTICLE{2021JCAP...10..030G,
       author = {{Garc{\'\i}a-Garc{\'\i}a}, Carlos and {Ruiz-Zapatero}, Jaime and {Alonso}, David and {Bellini}, Emilio and {Ferreira}, Pedro G. and {Mueller}, Eva-Maria and {Nicola}, Andrina and {Ruiz-Lapuente}, Pilar},
        title = "{The growth of density perturbations in the last  10 billion years from tomographic large-scale structure data}",
      journal = {\jcap},
     keywords = {cosmological parameters from LSS, galaxy clustering, redshift surveys, weak gravitational lensing, Astrophysics - Cosmology and Nongalactic Astrophysics},
         year = 2021,
        month = oct,
       volume = {2021},
       number = {10},
          eid = {030},
        pages = {030},
          doi = {10.1088/1475-7516/2021/10/030},
archivePrefix = {arXiv},
       eprint = {2105.12108},
 primaryClass = {astro-ph.CO},
       adsurl = {https://ui.adsabs.harvard.edu/abs/2021JCAP...10..030G},
      adsnote = {Provided by the SAO/NASA Astrophysics Data System}}
```
and as many papers as feel relevant from the publication list above.
